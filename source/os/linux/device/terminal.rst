终端设备
========================================

简介
----------------------------------------
在计算机早期，人们将一种被称作teletype的设备连到计算机上，作为计算机的终端，使得人们可以操作计算机。计算机为了支持这些teletype，于是设计了名为TTY的子系统。而后随着计算机技术的不断发展，teletype这些设备逐渐消失，但是内核TTY驱动这一架构没有发生变化，和系统中的进程进行I/O交互时还是需要通过TTY设备，于是出现了各种终端模拟软件。

串行端口终端 (/dev/ttySn)
----------------------------------------
串行端口终端(Serial Port Terminal)是使用计算机串行端口连接的终端设备。计算机把每个串行端口都看作是一个字符设备。

这些串行端口所对应的设备名称是/dev/tts/0(或/dev/ttyS0)、/dev/tts/1(或/dev/ttyS1)等，设备号分别是(4,0)、(4,1)等，分别对应于DOS系统下的COM1、COM2等。

伪终端 (/dev/pty/) 
----------------------------------------
伪终端(Pseudo Terminal)是成对的逻辑终端设备，提供双向通信，一般由master与slave组成，例如/dev/ptyp3和/dev/ttyp3，它们与实际物理设备并不直接相关。pty的出现是为了网络登陆（ssh登陆、telnet登陆等）、Xwindow等登陆需求。

如果一个程序把ttyp3看作是一个串行端口设备，则它对该端口的读/写操作会反映在该逻辑终端设备对的另一个上面(ttyp3)。而ttyp3则是另一个程序用于读写操作的逻辑设备。这样，两个程序就可以通过这种逻辑设备进行互相交流，而其中一个使用ttyp3的程序则认为自己正在与一个串行端口进行通信。

pty历史上有BSD与UNIX 98两套接口标准，当前大多数pts都是基于UNIX 98标准来实现的。

UNIX 98标准通过调用 ``posix_openpt`` 打开未使用的UNIX 98伪终端主机。 (此函数将打开主克隆设备/dev/ptmx)。执行任何特定于程序的初始化之后，使用 ``grantpt`` 更改从属设备的所有权和权限，并使用 ``unlockpt`` 解锁从属设备。可以通过在调用 ``open`` 时传递 ``ptsname`` 返回的名称来打开相应的从属设备。

pty是虚拟终端 (pseudo-tty)，pts(pseudo-terminal slave)是pty的实现方法，和ptmx(/dev/ptmx, pseudo-terminal master x)配合使用实现pty。

Linux内核对可用的UNIX 98伪终端的数量施加了限制。在2.6.3及以下版本的内核中，此限制是在内核编译时(CONFIG_UNIX98_PTYS)配置的，允许的伪终端数量最多为2048，默认设置为256。自内核2.6.4起，此限制为可以通过 ``/proc/sys/kernel/pty/max`` 进行动态调整， ``/proc/sys/kernel/pty/nr`` 指示当前使用了多少个伪终端。

其中/dev/ptmx是pty主设备， ``/dev/pts/*`` 是pty从设备。

BSD样式的伪终端以预先创建的对的形式提供，名称的形式为/dev/ptyXY(主)和/dev/ttyXY(从)，其中X是16个字符集[p-za-e]中的字母，Y是来自16个字符集[0-9a-f]的字母(这两组字母的精确范围在UNIX实现中有所不同)。例如，/dev/ptyp1和/dev/ttyp1构成一个BSD伪终端对。进程通过尝试打开每个伪终端主机直到打开成功找到未使用的伪终端对，然后可以打开相应的伪终端从站。

控制终端(/dev/tty) 
----------------------------------------
/dev/tty是当前进程的控制终端的设备特殊文件。可以使用命令 ``ps –ax`` 来查看进程与哪个控制终端相连。

控制台终端(/dev/ttyn, /dev/console) 
----------------------------------------
在Linux系统中，计算机显示器通常被称为控制台终端(Console)。它仿真了类型为Linux的一种终端(TERM=Linux)，并且有一些设备特殊文件与之相关联：tty0、tty1、tty2等。

当在控制台上登录时，使用的是tty1。使用Alt+[F1—F6]组合键时，就可以切换到tty2、tty3等上面去。tty1-tty6等称为虚拟终端，而tty0则是当前所使用虚拟终端的一个别名，系统所产生的信息会发送到该终端上。因此不管当前正在使用哪个虚拟终端，系统信息都会发送到控制台终端上。

其他
----------------------------------------
tty是终端设备的统称，可以将tty理解成一个管道(pipe)，将输入输出连接起来。

对用户空间的程序来说，TTY与PTS是透明的，但是从内核的视角看，pts的另一端连接ptmx，tty的另一端连接内核的终端模拟器，ptmx和终端模拟器都只是负责维护会话和转发数据包。ptmx的另一端连接用户空间的应用程序，如sshd、tmux等，而内核终端模拟器的另一端连接的是具体的硬件，如键盘和显示器。
