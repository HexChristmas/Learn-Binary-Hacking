信号
========================================

简介
----------------------------------------
信号机制是进程之间相互传递消息的一种方法，信号全称为软中断信号，也被称作软中断。

信号类型
----------------------------------------
- 与进程终止相关的信号
    - 进程退出
    - 子进程终止
- 与进程例外事件相关的信号
    - 进程越界
    - 写一个只读的内存区域
    - 执行一个特权指令及其他各种硬件错误
- 与在系统调用期间遇到不可恢复条件相关的信号。如执行系统调用exec时，原有资源已经释放，而目前系统资源又已经耗尽。
- 与执行系统调用时遇到非预测错误条件相关的信号。如执行一个并不存在的系统调用。
- 在用户态下的进程发出的信号。如进程调用系统调用kill向其他进程发送信号。
- 与终端交互相关的信号。如用户关闭一个终端，或按下break键等情况。
- 跟踪进程执行的信号

常见信号值
----------------------------------------
各信号值实际定义及含义在signum.h头文件中。

+------------+----------+----------+-------------------------------------+
| 信号       | 值       | 处理动作 | 发出信号的原因                      |
+============+==========+==========+=====================================+
|  SIGHUP    | 1        | A        | 终端挂起或者控制进程终止            |
+------------+----------+----------+-------------------------------------+
|  SIGINT    | 2        | A        | 键盘中断（如break键被按下）         |
+------------+----------+----------+-------------------------------------+
|  SIGQUIT   | 3        | C        | 键盘的退出键被按下                  |
+------------+----------+----------+-------------------------------------+
|  SIGILL    | 4        | C        | 非法指令                            |
+------------+----------+----------+-------------------------------------+
|  SIGABRT   | 6        | C        | 由abort(3)发出的退出指令            |
+------------+----------+----------+-------------------------------------+
|  SIGFPE    | 8        | C        | 浮点异常                            |
+------------+----------+----------+-------------------------------------+
|  SIGKILL   | 9        | AEF      | Kill信号                            |
+------------+----------+----------+-------------------------------------+
|  SIGSEGV   | 11       | C        | 无效的内存引用                      |
+------------+----------+----------+-------------------------------------+
|  SIGPIPE   | 13       | A        | 管道破裂: 写一个没有读端口的管道    |
+------------+----------+----------+-------------------------------------+
|  SIGALRM   | 14       | A        | 由alarm(2)发出的信号                |
+------------+----------+----------+-------------------------------------+
|  SIGTERM   | 15       | A        | 终止信号                            |
+------------+----------+----------+-------------------------------------+
|  SIGUSR1   | 30,10,16 | A        | 用户自定义信号1                     |
+------------+----------+----------+-------------------------------------+
|  SIGUSR2   | 31,12,17 | A        | 用户自定义信号2                     |
+------------+----------+----------+-------------------------------------+
|  SIGCHLD   | 20,17,18 | B        | 子进程结束信号                      |
+------------+----------+----------+-------------------------------------+
|  SIGCONT   | 19,18,25 | Z        | 进程继续（曾被停止的进程）          |
+------------+----------+----------+-------------------------------------+
|  SIGSTOP   | 17,19,23 | DEF      | 终止进程                            |
+------------+----------+----------+-------------------------------------+
|  SIGTSTP   | 18,20,24 | D        | 控制终端（tty）上按下停止键         |
+------------+----------+----------+-------------------------------------+
|  SIGTTIN   | 21,21,26 | D        | 后台进程企图从控制终端读            |
+------------+----------+----------+-------------------------------------+
|  SIGTTOU   | 22,22,27 | D        | 后台进程企图从控制终端写            |
+------------+----------+----------+-------------------------------------+
|  SIGBUS    | 10,7,10  | C        | 总线错误(错误的内存访问)            |
+------------+----------+----------+-------------------------------------+
|  SIGPOLL   | A        | Sys      | V定义的Pollable事件，与SIGIO同义    |
+------------+----------+----------+-------------------------------------+
|  SIGPROF   | 27,27,29 | A        | Profiling定时器到                   |
+------------+----------+----------+-------------------------------------+
|  SIGSYS    | 12,-,12  | C        | 无效的系统调用 (SVID)               |
+------------+----------+----------+-------------------------------------+
|  SIGTRAP   | 5        | C        | 跟踪/断点捕获                       |
+------------+----------+----------+-------------------------------------+
|  SIGURG    | 16,23,21 | B        | Socket出现紧急条件(4.2 BSD)         |
+------------+----------+----------+-------------------------------------+
|  SIGVTALRM | 26,26,28 | A        | 实际时间报警时钟信号(4.2 BSD)       |
+------------+----------+----------+-------------------------------------+
|  SIGXCPU   | 24,24,30 | C        | 超出设定的CPU时间限制(4.2 BSD)      |
+------------+----------+----------+-------------------------------------+
|  SIGXFSZ   | 25,25,31 | C        | 超出设定的文件大小限制(4.2 BSD)     |
+------------+----------+----------+-------------------------------------+
|  SIGIOT    | 6        | C        | IO捕获指令，与SIGABRT同义           |
+------------+----------+----------+-------------------------------------+
|  SIGEMT    | 7,-,7    |          |                                     |
+------------+----------+----------+-------------------------------------+
|  SIGSTKFLT | -,16,-   | A        | 协处理器堆栈错误                    |
+------------+----------+----------+-------------------------------------+
|  SIGIO     | 23,29,22 | A        | 某I/O操作现在可以进行了(4.2 BSD)    |
+------------+----------+----------+-------------------------------------+
|  SIGCLD    | -,-,18   | A        | 与SIGCHLD同义                       |
+------------+----------+----------+-------------------------------------+
|  SIGPWR    | 29,30,19 | A        | 电源故障(System V)                  |
+------------+----------+----------+-------------------------------------+
|  SIGINFO   | 29,-,-   | A        | 与SIGPWR同义                        |
+------------+----------+----------+-------------------------------------+
|  SIGLOST   | -,-,-    | A        | 文件锁丢失                          |
+------------+----------+----------+-------------------------------------+
|  SIGWINCH  | 28,28,20 | B        | 窗口大小改变(4.3 BSD, Sun)          |
+------------+----------+----------+-------------------------------------+
|  SIGUNUSED | -,31,-   | A        | 未使用的信号(will be SIGSYS)        |
+------------+----------+----------+-------------------------------------+

处理动作一项中的字母含义如下

- A 默认动作是终止进程
- B 默认动作是忽略此信号
- C 默认动作是终止进程并进行内核映像转储
- D 默认动作是停止进程
- E 信号不能被捕获
- F 信号不能被忽略 

信号处理
----------------------------------------
内核给一个进程发送软中断信号的方法，是在进程所在的进程表项的信号域设置对应于该信号的位。

需要补充的是，如果信号发送给一个正在睡眠的进程，则需要看该进程进入睡眠的优先级，如果进程睡眠在可被中断的优先级上，则唤醒进程；否则仅设置进程表中信号域相应的位，而不唤醒进程。

进程检查是否收到信号的时机是：一个进程在即将从内核态返回到用户态时；或者在一个进程要进入或离开一个适当的低调度优先级睡眠状态时。

内核处理一个进程收到的信号的时机是在一个进程从内核态返回用户态时。所以，当一个进程在内核态下运行时，软中断信号并不立即起作用，要等到将返回用户态时才处理。进程只有处理完信号才会返回用户态，进程在用户态下不会有未处理完的信号。 

内核处理一个进程收到的软中断信号是在该进程的上下文中，因此，进程必须处于运行状态。

处理信号有三种类型：进程接收到信号后退出；进程忽略该信号；进程收到信号后执行用户设定用系统调用signal的函数。
