Windows
========================================

运行模式
----------------------------------------
Windows支持Intel x86/x64 的两种处理器模式内核模式（Ring 0）和用户模式（Ring 3）。

内核模式下的代码可以访问所有的内存空间；可以直接操纵硬件。用户模式下的代码无权访问系统空间的内存页面；无法直接操纵硬件。用户模式向内核模式的切换是受控制的。

基本模块
----------------------------------------
Windows操作系统内核模式下的基本模块包含Windows执行体、Windows内核体、设备驱动程序、窗口和图形系统、硬件抽象层。

其中Windows执行体是Windows内核体的上层接口，包含了基本的操作系统服务，如进程与线程管理、内存管理、I/O管理、网络连接、进程间通信以及安全服务。

Windows内核体实现与硬件体系结构支持的代码，实现底层的操作系统功能，如线程调度 、中断和异常分发处理、多处理器同步等。

设备驱动程序包括硬件设备驱动程序、文件系统与网络设备驱动程序。

窗口和图形系统即Win32k.sys（Windows子系统的内核模式部分），实现了图形用户界 面（GUI）函数，包括窗口的处理、绘制等。

硬件抽象层即Hal.dll文件，用于屏蔽Windows内核、驱动程序与平台硬件差异性的底 层代码。

系统进程
----------------------------------------
- Csrss.exe
    - Windows子系统进程，即客户端/服务器运行进程
- Smss.exe
    - 会话（Session）管理器，系统启动时第一个运行的进程
- Winlogon.exe
    - 处理交互式登录
- Services.exe
    - 服务控制管理器，负责启动和、停止、暂停、恢复服务
- Svchost.exe
    - 共享进程服务的宿主进程
- Lsass.exe
    - 本地安全授权子系统，验证用户登录、授权和审计

管理机制
----------------------------------------
Windows主要使用注册表和服务来管理。

注册表（Registry）是包含操作系统和其它软件的所有设置和配置相关数据的目录。

注册表的逻辑结构类似于磁盘上的文件系统。注册表包含了键（key）和值（value）。其中键类似文件系统中的目录，而值就像文件，键可以包含子键（subkey）和值。值中存储着配置数据，数据有多种类型。最顶层的键称为根键（root key）。

服务（Services）程序是后台运行的进程，常用来执行特定的任务，不需要和用户进行交互。比如自动更新服务、后台智能传输服务、事件日志服务等。

服务程序受Service Control Manager（SCM，即services.exe进程）所控制，其服务程序的配置数据位于 ``HKLM\System\CurrentControlSet\Services`` 。


参考链接
----------------------------------------
- `windows kernel exploit tutorial <https://www.redog.me/tags/windows-kernel-exploit-tutorial/>`_
